<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Lewis J. Martin</title>
        <meta itemprop="datePublished" content="2021-03-15">
        <!-- alternative nav bar: https://nixing.mx/blog/css-grid-nav-bar.html -->
        <link rel="stylesheet" href="../stylesheet.css" media="screen"/>
</head>

<nav>
        <ul>
                <li><strong>LJM</strong></li>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../papers.html">Papers</a></li>
		<li><a href="../sideprojects.html">Side-projects</a></li>
		<li><a href="../blog.html">Blog</a></li>
        </ul>
</nav>

<main>
  <h1> Ligand overlay 3: meshing the solvent-excluded surface </h1>
  <p>
    <a href="https://github.com/ljmartin/align/blob/main/0.3%20meshing%20the%20SES.ipynb">Notebook on github - Step 3 meshing the SES</a></br>
    <a href="https://github.com/ljmartin/align/blob/main/SESMesh.py">SESMesh.py</a>
  <center><img src="./pics/mesh.png", width="300"></center>    
  <p>Volume overlap techniques calculate volume using either voxels (David Koes lab, <a href="https://doi.org/10.1002/jcc.23690">doi</a>) or Gaussian approximation of atoms (Grant et al <a href="https://doi.org/10.1002/(SICI)1096-987X(19961115)17:14<1653::AID-JCC7>3.0.CO;2-K">doi</a>, alternatively Silicos ShapeIt or <a href="https://doi.org/10.1002/jcc.23603">gWEGA</a>). Gaussians are nice because volume overlap becomes differentiable, and voxels are nice because the calculations are extremely fast, although they are dependent on initial orientation because they can't be rotated.

  <p>To my knowledge no one has used triangular meshes of the solvent-excluded surface (see pic above). Meshes are nice because volume is well defined and they are deformable. Most importantly, though, they model shape using the outer surface of a molecule, which is the crucial feature of shape overlap techniques. As described in the <a href="https://doi.org/10.1021/ci300601q">WEGA paper</a>, using Gaussians can lead to weird artifacts where some moieties have 2- to 6-fold more volume overlap than they should thanks to overlapping Gaussian centres, which are more dense. This won't happen with a mesh.  

  <p>If the mesh models the so-called 'solvent-excluded surface' (SES) then it is totally blind to the identity of the underlying atoms, which hopefully leads to better scaffold-hopping potential while also keeping volume overlap accurate. The SES is like a shrink-wrapped surface that measures the volume where a solvent molecule can't sample. 

  <p>There's no formal solution for the SES - over the decades there have been tens of different approaches - all of which work pretty well but differ in memory and time requirements. My favourite approach is the one <a href="https://www.cgl.ucsf.edu/chimera/data/surface-oct2013/surface.html">ChimeraX</a> by Tom Godard, because it's fast and practical.

  <p>There aren't any SES meshing applications in python, though. It took months of fiddling, but I worked out a way to do it with just numpy and scipy that takes ~500ms per molecule. It starts by sampling points on the VDW surface and solvent-accessible surface, then removes points that would overlap another atom. The re-entrant surfaces of the SES are generated by translating any VDW points that are inaccessible by a probe sphere. This is followed by marching cubes. In 3D, it generates the mesh above, in 2D, it looks like this:  

    <center><img src="./pics/meshalg.png", width="300"></center>

    <p>There's a lot of improvements to make. For starters, the algorithm is quadratic in atom number so it will freeze your laptop if you attempt a whole protein. In addition, the marching_cubes algorithm could be restricted to just the grid points adjacent to the SES, rather than every grid point in the bounding box. But for now - it works :)  

  
